<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <link href="/css/header.css" rel="stylesheet">
    <meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
    <meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
    <th:block th:replace="~{fragment/header :: header(${member!=null ? member : null})}"></th:block>

<div th:object="${item}">
    <th:block th:each="image : ${item.itemImageList}">
        <img th:src="@{'/images/'+${image.imgName}}" width="200" height="200"/>
    </th:block>
    <div>
        <span id="name" th:text="*{name}"></span>
    </div>
    <div>
        <span id="price" th:text="*{price+'원'}"></span>
    </div>
    <div>
        <span id="quantity" th:text="*{'남은수량 ' + quantity+'개'}"></span>
    </div>
    <div>
        <span id="content" th:text="*{'상품설명'+content}"></span>
    </div>
    <form method="post">
        <span>구매 수량</span>
        <input id="count" type="number" value="1" min="1" />
        <button type="submit">구입</button>
        <button id="cart" type="button" onclick="addCart()">장바구니</button>
    </form>
</div>
</body>
</html>
<script th:inline="javascript">
    function addCart(){
        const header = document.querySelector('meta[name="_csrf_header"]').content;
        const token = document.querySelector('meta[name="_csrf"]').content;

        fetch("/carts",{
            method:"Post",
            headers: {
                "header": header,
                "Content-Type": "application/json",
                "X-CSRF-Token": token
            },
            body:JSON.stringify({
                memberId:[[${member.memberId}]],
                itemId:[[${item.itemId}]],
                count:document.querySelector("#count").value
            })
        }).then(response=>{
            if(response.status==200){
                alert("성공했습니다.");
            } else {
                alert("실패했습니다.")
            }
        })
    }

</script>